import{u as D,b as m,L as O,M as k,c as g,C as A,B as R,N as S,O as B,q as x,P as T,Q as L,R as j,I as _,_ as q}from"./entry.4fe812e8.js";import{o as I}from"./ready.1e939020.js";import{w as v,s as M}from"./utils.e234284c.js";import{u as N}from"./preview.0c34d8e8.js";const Q=()=>null;function Y(...t){const r=typeof t[t.length-1]=="string"?t.pop():void 0;typeof t[0]!="string"&&t.unshift(r);let[e,a,s={}]=t;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof a!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");s.server=s.server??!0,s.default=s.default??Q,s.lazy=s.lazy??!1,s.immediate=s.immediate??!0;const n=D(),i=()=>n.isHydrating?n.payload.data[e]:n.static.data[e],u=()=>i()!==void 0;n._asyncData[e]||(n._asyncData[e]={data:m(i()??s.default()),pending:m(!u()),error:O(n.payload._errors,e),status:m("idle")});const o={...n._asyncData[e]};o.refresh=o.execute=(l={})=>{if(n._asyncDataPromises[e]){if(l.dedupe===!1)return n._asyncDataPromises[e];n._asyncDataPromises[e].cancelled=!0}if((l._initial||n.isHydrating&&l._initial!==!1)&&u())return i();o.pending.value=!0,o.status.value="pending";const d=new Promise((c,p)=>{try{c(a(n))}catch(E){p(E)}}).then(c=>{if(d.cancelled)return n._asyncDataPromises[e];let p=c;s.transform&&(p=s.transform(c)),s.pick&&(p=F(p,s.pick)),o.data.value=p,o.error.value=null,o.status.value="success"}).catch(c=>{if(d.cancelled)return n._asyncDataPromises[e];o.error.value=c,o.data.value=R(s.default()),o.status.value="error"}).finally(()=>{d.cancelled||(o.pending.value=!1,n.payload.data[e]=o.data.value,o.error.value&&(n.payload._errors[e]=S(o.error.value)),delete n._asyncDataPromises[e])});return n._asyncDataPromises[e]=d,n._asyncDataPromises[e]};const h=()=>o.refresh({_initial:!0}),w=s.server!==!1&&n.payload.serverRendered;{const l=B();if(l&&!l._nuxtOnBeforeMountCbs){l._nuxtOnBeforeMountCbs=[];const c=l._nuxtOnBeforeMountCbs;l&&(k(()=>{c.forEach(p=>{p()}),c.splice(0,c.length)}),g(()=>c.splice(0,c.length)))}w&&n.isHydrating&&u()?(o.pending.value=!1,o.status.value=o.error.value?"error":"success"):l&&(n.payload.serverRendered&&n.isHydrating||s.lazy)&&s.immediate?l._nuxtOnBeforeMountCbs.push(h):s.immediate&&h(),s.watch&&A(s.watch,()=>o.refresh());const d=n.hook("app:data:refresh",c=>{if(!c||c.includes(e))return o.refresh()});l&&g(d)}const y=Promise.resolve(n._asyncDataPromises[e]).then(()=>o);return Object.assign(y,o),y}async function Z(t){await new Promise(e=>I(e));const r=t?Array.isArray(t)?t:[t]:void 0;await D().hooks.callHookParallel("app:data:refresh",r)}function F(t,r){const e={};for(const a of r)e[a]=t[a];return e}const P=(t,r)=>r.split(".").reduce((e,a)=>e&&e[a],t),$=(t,r)=>Object.keys(t).filter(r).reduce((e,a)=>Object.assign(e,{[a]:t[a]}),{}),ee=t=>r=>Array.isArray(r)?r.map(e=>t(e)):t(r),b=t=>{const r=[],e=[];for(const a of t)["$","_"].includes(a)?r.push(a):e.push(a);return{prefixes:r,properties:e}},te=(t=[])=>r=>{if(t.length===0||!r)return r;const{prefixes:e,properties:a}=b(t);return $(r,s=>!a.includes(s)&&!e.includes(s[0]))},re=(t=[])=>r=>{if(t.length===0||!r)return r;const{prefixes:e,properties:a}=b(t);return $(r,s=>a.includes(s)||e.includes(s[0]))},se=(t,r)=>{const e=new Intl.Collator(r.$locale,{numeric:r.$numeric,caseFirst:r.$caseFirst,sensitivity:r.$sensitivity}),a=Object.keys(r).filter(s=>!s.startsWith("$"));for(const s of a)t=t.sort((n,i)=>{const u=[P(n,s),P(i,s)].map(o=>{if(o!==null)return o instanceof Date?o.toISOString():o});return r[s]===-1&&u.reverse(),e.compare(u[0],u[1])});return t},ne=(t,r="Expected an array")=>{if(!Array.isArray(t))throw new TypeError(r)},f=t=>Array.isArray(t)?t:[void 0,null].includes(t)?[]:[t],H=["sort","where","only","without"],z=(t,r)=>{const e={...r};for(const n of H)e[n]&&(e[n]=f(e[n]));const a=(n,i=u=>u)=>(...u)=>(e[n]=i(...u),s),s={params:()=>({...e,...e.where?{where:[...f(e.where)]}:{},...e.sort?{sort:[...f(e.sort)]}:{}}),only:a("only",f),without:a("without",f),where:a("where",n=>[...f(e.where),...f(n)]),sort:a("sort",n=>[...f(e.sort),...f(n)]),limit:a("limit",n=>parseInt(String(n),10)),skip:a("skip",n=>parseInt(String(n),10)),find:()=>t(s),findOne:()=>(e.first=!0,t(s)),findSurround:(n,i)=>(e.surround={query:n,...i},t(s)),locale:n=>s.where({_locale:n})};return s};function C(t){return JSON.stringify(t,K)}function K(t,r){return r instanceof RegExp?`--REGEX ${r.toString()}`:r}const U=t=>{let r=C(t);return r=typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r),r=r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),(r.match(/.{1,100}/g)||[]).join("/")},G=()=>async t=>{const{content:r}=x().public,e=t.params(),a=r.experimental.stripQueryParameters?v(`/query/${`${_(e)}.${r.integrity}`}/${U(e)}.json`):v(`/query/${_(e)}.${r.integrity}.json`);if(M())return(await q(()=>import("./client-db.1fa3b0b7.js"),["./client-db.1fa3b0b7.js","./entry.4fe812e8.js","./entry.9c85df70.css","./index.a6ef77ff.js","./preview.0c34d8e8.js","./ready.1e939020.js","./utils.e234284c.js"],import.meta.url).then(i=>i.useContentDatabase())).fetch(t);const s=await $fetch(a,{method:"GET",responseType:"json",params:r.experimental.stripQueryParameters?void 0:{_params:C(e),previewToken:N().getPreviewToken()}});if(typeof s=="string"&&s.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return s};function ae(t,...r){const{content:e}=x().public,a=z(G(),typeof t!="string"?t:{});let s;typeof t=="string"&&(s=T(L(t,...r)));const n=a.params;return a.params=()=>{var u,o,h;const i=n();return s&&(i.where=i.where||[],i.first&&(i.where||[]).length===0?i.where.push({_path:j(s)}):i.where.push({_path:new RegExp(`^${s.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(u=i.sort)!=null&&u.length||(i.sort=[{_file:1,$numeric:!0}]),e.locales.length&&((h=(o=i.where)==null?void 0:o.find(y=>y._locale))!=null&&h._locale||(i.where=i.where||[],i.where.push({_locale:e.defaultLocale}))),i},a}export{ne as a,f as b,ee as c,re as d,U as e,z as f,P as g,C as j,ae as q,Z as r,se as s,Y as u,te as w};
